---
sidebar_label v2: Payload Format 
---

# Payload Format of Smart Label v2 - [draft - Anything is subject to change] 

## Downlinks
| Port | Name                                                                   |   Type   | Description                                                                                                           |
|------|------------------------------------------------------------------------|----------|-----------------------------------------------------------------------------------------------------------------------|
| 151  | [Set](#set-uplink)                                                     | Uplink | Contains a list of TLV values to be written to the device                       |
| 152  | [Get](#get-uplink)                                                     | Uplink | Contains a list of TLV values to be read from the device                       |
| 153  | [Action](#action-uplink)                                               | Uplink | Contains a list of TLV values which will trigger an action                     |
| 160  | [Sequence](#sequence-uplink)                                           | Uplink | Contains sequence number and optional bitfield with the missing packets        |

## Uplinks
| Port | Name                                                                   |   Type   | Description                                                                                                           |
|------|------------------------------------------------------------------------|----------|-----------------------------------------------------------------------------------------------------------------------|
| 101  | [Errors](#errors-uplink)                                               | Uplink | Contains a list of TLV values containing errors generated by the device |
| 150  | [Settings](#settings-uplink)                                           | Uplink | Contains a list of TLV values containing various configuration data |
| 180  | [GNSS-NA Localization Message](#gnss-na-message-format)                | Uplink | One or two GNSS-NA (network assisted) localization messages are sent after a successful GNSS-NG scan.       |
| 181  | [GNSS-SA Localization Message](#gnss-c-message-format)                 | Uplink | A single GNSS-SA (stand alone) localization messages is sent after a successful GNSS scan.       |
| 190  | [Wi-Fi Localization Message](#wi-fi-message-format)                    | Uplink | A single Wi-Fi localization message is sent after a successful Wi-Fi scan.     |
| 191  | [Wi-Fi Localization Message (compact)](#wi-fi-message-format)          | Uplink | A single compact Wi-Fi (based on filters) localization message is sent after a successful Wi-Fi scan.     |
| 200  | [BLE Localization Message](#ble-message-format)                        | Uplink | A single BLE localization message is sent after a successful BLE scan.     |
| 201  | [BLE Localization Message (compact)](#ble-message-format)              | Uplink | A single compact BLE (based on filters) localization message is sent after a successful BLE scan.|


## TLV list of IDs

|  # | Name                             | Tag  | Size | Format | Description | Range | Default |
|----|----------------------------------|------|------|------- |-------------|-------|---------|
|  1 | Device flags                     | 0x10 |    1 | uint8_t (bitfield) | bit 0: GNSS_ENABLE<br/>bit 1: WIFI_ENABLE<br/>bit 2: BLE_ENABLE<br/>bit 3: MOVEMENT_ENABLE<br/>bit 4: BLE_FWU_ENABLED<br/>    | 0 - 1 | 1<br/>1<br/>1<br/>1<br/>1 |
|  2 | Heartbeat interval               | 0x14 |    1 | uint8_t | Hours | 1 - 255 | 24 |
|  3 | Asset tracking Intervals         | 0x18 |    4 | uint16_t <br/> uint16_t<br/> | Moving: Minutes<br/> Steady: Minutes  | ??<br/>?? | 15 <br/> 60|
|  4 | Acceleration sensitivity         | 0x1C |    2 | uint16_t | mG  | 1 - 16000 | 50      |
|  5 | Movement detection plan          | 0x20 |    5 | uint8_t<br/> uint8_t<br/> uint8_t<br/> uint8_t<br/>uint8_t<br/>   | slice_time_seconds<br/> window_slice_count <br/> window_slice_required <br/> start_move_win_count <br/> stop_move_win_count <br/>| 1 - 255<br/> 1 - 255<br/> 1 - 255<br/> 1 - 255<br/> 1 - 255<br/> | 1<br/>5<br/>3<br/>3<br/>4    |
|  6 | Battery                          | 0x24 |    3 | uint8_t<br/> uint16_t | Percentage<br/> Voltage | 0-100<br/> (hw dependent)    | |
|  7 | Reset data                       | 0x28 |    3 | uint8_t<br/> uint16_t | Reason<br/>Count |   |   |
|  8 | Scan Counts                      | 0x2C |   12 | uint16_t<br/> uint16_t<br/> uint16_t<br/>uint16_t<br/> uint16_t<br/> uint16_t | GNSS successful scan count<br/>WiFi successful scan count<br/>BLE successful scan count<br/>GNSS failed scan count<br/>WiFi failed scan count<br/>BLE failed scan count<br/> |     |
|  9 | ADR                              | 0x30 |    1 | uint8_t | 0: DR5 (EU868 SF7)<br/> 1: DR4 (EU868 SF8)<br/>2: DR3 (EU868 SF9, US915 SF7)<br/>3: DR2 (EU868 SF10, US915 SF8)<br/>4: DR1 (EU868 SF11, US915 SF9)<br/>5: DR0 (EU868 SF12)<br/>6: DR1-3 array (EU868 SF9-11, US915 SF7-9) <br/>7: ADR (SF7-12) for EU868     | 0 - 7 |2 |
| 10 | Buffer level                     | 0x34 |    2 | uint16_t | Number of stored unconfirmed messages in its internal memory | 0 - 65535 | - |
| 11 | Buffer TTL                       | 0x38 |    2 | uint16_t | The number of days after a buffered message will be discarded without being re-sent<br/> Value of 0 means disabled. | 0 - 65535 | 30 |
| 12 | Buffer Seq Confirmation          | 0x3C | 2-n | uint16_t<br/>uint8_t*n| Seq number.<br/> Bitfield where 1 means missing, 0 means received. Each bit represents a Seq number and its value is computed as: provided Seq - bit position. | Seq: 0 - 65535 (w/ overflow) <br/>Bitfield: [0-1] |
| 13 | Advertisement BLE duration FWU   | 0x40 |    1 | uint8_t | Seconds  | 1 - 255 |   60 |
| 14 | Heartbeat TLV bundle             | 0x44 |  1-n | uint8_t*n  | TLV IDs list that hearbeat message should contain  | * | 0x24 0x2C 0x34 |
| 15 | Generic TLV bundle               | 0x48 |  1-n | uint8_t*n  | TLV IDs list (used for Get/Action downlink) | * | - |
| 16 | Value range error TLV bundle     | 0x4C |  1-n | uint8_t*n  | TLV IDs list containing which Set values were denied because their range | * | - |
| 17 | Internal device error            | 0x50 |  1-n | uint8_t*n  | Contains an error code byte with optional additional specific data | * | - |
| 18 | Firmware CRC32                   | 0x54 |    4 | uint32_t | CRC32 of the current FW | |
| 19 | FW & HW Version                  | 0x58 |    4 | uint8_t<br/>uint8_t<br/>uint8_t<br/>uint8_t<br/> | FW ver major<br/>FW ver minor<br/>FW ver patch<br/>HW version<br/> | | |
| 20 | Clear stored buffer              | 0x5C |    0 | -    | Clears the stored buffer  | |
| 21 | Localization action              | 0x60 |    0 | -    | Triggers the localization   | |
| 22 | Reset device action              | 0x64 |    0 | -    | Resets the device      | |
| 23 | Operation Mode                   | 0x68 |    1 | uint8_t | Operation mode value | 0x10 - Shelf<br/> 0x20 - Normal| |
| 24 | WiFi Filter                      | 0x6C |  3-8 | int8_t <br/> int8_t <br/>uint8_t*n<br/> | Min RSSI<br/>Head or Tail<br/> MAC addr bytes (1-6) | -128 to 127<br/> -1 or 1<br/>MAC bytes | |
| 25 | BLE Filter                       | 0x70 |  3-8 | int8_t <br/> int8_t <br/>uint8_t*n<br/> | Min RSSI<br/>Head or Tail<br/> MAC addr bytes (1-6) | -128 to 127<br/> -1 or 1<br/>MAC bytes | |
| 26 | Battery thresholds               | 0x74 |   2  | uint8_t <br/> uint8_t| Low battery percentage <br/> Critical battery percentage | 0-100<br/>0-100 | 40%<br/>20% |

<br/>

# Downlinks
## Set - port 151
|  Byte Lenght |   (Tag) 1  |    TLV 1      | TLV x |
|--------------|------------|---------------|-----|
|  Field:      |    0x10    |   TLV 1 data  | ... |


## Get - port 152
### Generic - one TLV for each requested ID
|  Byte Lenght |   (Tag) 1  |  TLVs 1      | ... |
|--------------|------------|---------------|-----|
|  Field:      |    0x10    |   TLV 1 data  | ... |

### Bundle - one single TLV containing a list of TLV IDs. The ID for bundle is '0x48'
|  Byte Lenght |   (Tag) 1  |     TLV ID 0x48     |
|--------------|------------|-------------|
|  Field:      |    0x10    |   TLV data (1..n)  |


## Action - port 153
### Generic - one TLV for each requested ID
|  Byte Lenght |   (Tag) 1  |  TLVs 1      | ... |
|--------------|------------|---------------|-----|
|  Field:      |    0x10    |   TLV 1 data  | ... |

### Bundle - one single TLV containing a list of TLV IDs
|  Byte Lenght |   (Tag) 1  |     TLV ID 0x48     |
|--------------|------------|---------------------|
|  Field:      |    0x10    |   TLV data (1..n)   |



# Uplinks format
## GNSS Localization Message - port 180
### GNSS payload format summary by Tag
|  Tag |  Seq  |  Timestamp  |   GHDR  |  NAV  | Description |
|------|-------|-------------|---------|-------|------------------|
| 0x10 |       |             |     X   |   X   |  (Moving) GNSS   |
| 0x14 |       |      X      |     X   |   X   |  (Moving) ts + GNSS   |
| 0x18 |       |             |     X   |   X   |  (Steady) GNSS      |
| 0x1C |       |      X      |     X   |   X   |  (Steady) ts + GNSS   |
| 0x80 |   X   |             |     X   |   X   |  (Moving) seq + GNSS  |
| 0x84 |   X   |      X      |     X   |   X   |  (Moving) seq + ts + GNSS |
| 0x88 |   X   |             |     X   |   X   |  (Steady) seq + GNSS |
| 0x8C |   X   |      X      |     X   |   X   |  (Steady) seq + ts + GNSS |

### GNSS localization data encoding
|  Byte Lenght |   1  |  1-n  |
|--------------|------|-------------------|
|  Field:      | GHDR |   U-GNSSLOC-NAV   |

### GHDR: Group Header
|  Bits  |  7  |   6-5    |   4-0    |
|--------|-----|----------|----------|
| Field: | EOG | RFU=0b00 | GRP_TOKEN|


## Wi-Fi Localization Message - port 190

### Wi-Fi payload format summary by Tag, full MAC addr
|  Tag |  Seq  |  Timestamp  |   (RSSI+MAC)*n  |   Description |
|------|-------|-------------|-----------------|---------------|
| 0x10 |       |             |        X        |  (Moving) WiFi   |
| 0x14 |       |      X      |        X        |  (Moving) ts + WiFi   |
| 0x18 |       |             |        X        |  (Steady) WiFi      |
| 0x1C |       |      X      |        X        |  (Steady) ts + Wifi   |
| 0x80 |   X   |             |        X        |  (Moving) seq + WiFi  |
| 0x84 |   X   |      X      |        X        |  (Moving) seq + ts + WiFi |
| 0x88 |   X   |             |        X        |  (Steady) seq + WiFi |
| 0x8C |   X   |      X      |        X        |  (Steady) seq + ts + WiFi |

## Wi-Fi Localization Message (Compact) - port 191

### Wi-Fi format summary by Tag, compact MAC addr
|  Tag |  Seq  |  Timestamp  |   Compact Wi-Fi Data  |   Description |
|------|-------|-------------|-----------------|---------------|
| 0x10 |       |             |        X        |  (Moving) Wi-Fi   |
| 0x14 |       |      X      |        X        |  (Moving) ts + Wi-Fi   |
| 0x18 |       |             |        X        |  (Steady) Wi-Fi      |
| 0x1C |       |      X      |        X        |  (Steady) ts + Wi-Fi   |
| 0x80 |   X   |             |        X        |  (Moving) seq + Wi-Fi  |
| 0x84 |   X   |      X      |        X        |  (Moving) seq + ts + Wi-Fi |
| 0x88 |   X   |             |        X        |  (Steady) seq + Wi-Fi |
| 0x8C |   X   |      X      |        X        |  (Steady) seq + ts + Wi-Fi |

## BLE Localization Message - port 200

### BLE format summary by Tag, full MAC addr
|  Tag |  Seq  |  Timestamp  |   (RSSI+MAC)*n  |   Description |
|------|-------|-------------|-----------------|---------------|
| 0x10 |       |             |        X        |  (Moving) BLE   |
| 0x14 |       |      X      |        X        |  (Moving) ts + BLE   |
| 0x18 |       |             |        X        |  (Steady) BLE      |
| 0x1C |       |      X      |        X        |  (Steady) ts + BLE   |
| 0x80 |   X   |             |        X        |  (Moving) seq + BLE  |
| 0x84 |   X   |      X      |        X        |  (Moving) seq + ts + BLE |
| 0x88 |   X   |             |        X        |  (Steady) seq + BLE |
| 0x8C |   X   |      X      |        X        |  (Steady) seq + ts + BLE |

## BLE Localization Message (Compact)  - port 201

### BLE format summary by Tag, compact MAC addr
|  Tag |  Seq  |  Timestamp  |   Compact BLE Data  |   Description |
|------|-------|-------------|-----------------|---------------|
| 0x10 |       |             |        X        |  (Moving) BLE   |
| 0x14 |       |      X      |        X        |  (Moving) ts + BLE   |
| 0x18 |       |             |        X        |  (Steady) BLE      |
| 0x1C |       |      X      |        X        |  (Steady) ts + BLE   |
| 0x80 |   X   |             |        X        |  (Moving) seq + BLE  |
| 0x84 |   X   |      X      |        X        |  (Moving) seq + ts + BLE |
| 0x88 |   X   |             |        X        |  (Steady) seq + BLE |
| 0x8C |   X   |      X      |        X        |  (Steady) seq + ts + BLE |

## Compact WiFi and BLE data format
|  Size: |  Variable Heat/Tail (1)  | 1    | 6  |   1  |    1-5    |     |   1  |    1-5    |
|--------|--------------------------|------|----|------|-----------|-----|------|-----------|
| Field: |   -5 to 5                | RSSI | Full MAC| RSSI | Short MAC | ... | RSSI | Short MAC |

When the Heat/Tail value is negative it tells how many bytes are different from the beginning of the full MAC.<br/>
When it's positive it tells how many bytes are different from the end of the full MAC

Ex: Head/Tail is -2:<br/>
Full MAC: `AA BB CC DD EE FF GG`<br/>
Short MAC: `HH II` <br/>
-> Short MAC expands to: `HH II CC DD EE FF GG`


Ex: Head/Tail is 2:<br/>
Full MAC: `AA BB CC DD EE FF GG`<br/>
Short MAC: `HH II` <br/>
-> Short MAC expands to: `AA BB CC DD HH II`



# Wi-Fi/BLE Detailed payload format:
### Wi-Fi/BLE, moving with no timestamp
|  Size: |  Tag (1)  | 1    | 6  |     | 1    | 6   |
|--------|-----------|------|----|-----|------|-----|
| Field: |   0x10    | RSSI | MAC| ... | RSSI | MAC |

### Wi-Fi/BLE, moving with timestamp
|  Size: |  Tag (1)  |      4    | 1    | 6   |     |   1  | 6   |
|--------|-----------|-----------|------|-----|-----|------| --- |
| Field: |    0x14   | Timestamp | RSSI | MAC | ... | RSSI | MAC |

### Wi-Fi/BLE, steady with no timestamp
|  Size: |  Tag (1)  | 1    | 6  |     | 1    | 6   |
|--------|-----------|------|----|-----|------|-----|
| Field: |   0x18    | RSSI | MAC| ... | RSSI | MAC |

### Wi-Fi/BLE, steady with timestamp
|  Size: |  Tag (1)  |      4    | 1    |  6  |     |   1  |  6  |
|--------|-----------|-----------|------|-----|-----|------|-----|
| Field: |    0x1C   | Timestamp | RSSI | MAC | ... | RSSI | MAC |

### Wi-Fi/BLE, packet sequence, moving with no timestamp
|  Size: |  Tag (1)  |  2   |  1   |  6  |     |  1   |  6  |
|--------|-----------|------|------|-----|-----|------|-----|
| Field: |   0x80    | Seq  | RSSI | MAC | ... | RSSI | MAC |

### Wi-Fi/BLE, packet sequence, moving with timestamp
|  Size: |  Tag (1)  |  2   |      4    | 1    | 6  |     | 1    | 6   |
|--------|-----------|------|-----------|----|-----|------|-----|------|
| Field: |    0x84   | Seq  | Timestamp | RSSI | MAC| ... | RSSI | MAC |

### Wi-Fi/BLE, packet sequence, steady with no timestamp
|  Size: |  Tag (1)  |  2   | 1    |  6  |     |  1  | 6   |
|--------|-----------|------|------|-----|-----|-----| ---- |
| Field: |   0x88    | Seq  | RSSI | MAC | ... | RSSI | MAC |

### Wi-Fi/BLE, packet sequence, steady with timestamp
|  Size: |  Tag (1)  |  2  |    4      |   1  |  6  |     |  1   |  6  |
|--------|-----------|-----|-----------|------|-----|-----|------|-----|
| Field: |    0x8C   | Seq | Timestamp | RSSI | MAC | ... | RSSI | MAC |





